{"version":3,"file":"plasmic-yotpo.cjs.production.min.js","sources":["../src/yotpo.tsx","../src/index.tsx"],"sourcesContent":["import { ComponentMeta, GlobalContextMeta } from \"@plasmicapp/host\";\nimport { usePlasmicQueryData } from \"@plasmicapp/query\";\nimport isArray from \"lodash/isArray\";\nimport React, { useContext } from \"react\";\n\nimport { Image, ProductElement, ReviewResponse } from \"./types\";\n\nexport function ensure<T>(x: T | null | undefined): T {\n  if (x === null || x === undefined) {\n    debugger;\n    throw new Error(`Value must not be undefined or null`);\n  } else {\n    return x;\n  }\n}\n\nconst modulePath = \"@plasmicpkgs/plasmic-yotpo\";\n\ninterface YotpoProps {\n  appKey: string;\n  uToken: string;\n}\n\nconst CredentialsContext = React.createContext<YotpoProps | undefined>(\n  undefined\n);\n\nexport const YotpoCredentialsProviderMeta: GlobalContextMeta<YotpoProps> = {\n  name: \"Yotpo\",\n  displayName: \"Yotpo Credentials Provider\",\n  description:\n    \"Your app key is sometimes referred to as your Store ID.[get your App Key](https://support.yotpo.com/en/article/finding-your-yotpo-app-key-and-secret-key).\",\n  importName: \"Yotpo\",\n  importPath: modulePath,\n  props: {\n    appKey: {\n      type: \"string\",\n      displayName: \"App Key\",\n      description: \"App Key of your Yotpo Store \",\n    },\n    uToken: {\n      type: \"string\",\n      displayName: \"UToken\",\n      description:\n        \"Utoken is required in non-public API calls to ensure private account data is accessible only by authorized users.\",\n    },\n  },\n};\n\nexport function YotpoCredentialsProvider({\n  appKey,\n  uToken,\n  children,\n}: React.PropsWithChildren<YotpoProps>) {\n  return (\n    <CredentialsContext.Provider value={{ appKey, uToken }}>\n      {children}\n    </CredentialsContext.Provider>\n  );\n}\n\ninterface YotpoReviewsProps {\n  reviewId?: string;\n  productPrice?: string;\n  currency?: string;\n  setControlContextData?: (data: {\n    reviews?: { name: string; id: number }[];\n  }) => void;\n  className?: string;\n}\n\nexport const YotpoReviewsMeta: ComponentMeta<YotpoReviewsProps> = {\n  name: \"hostless-yotpo-star-reviews\",\n  displayName: \"Yotpo Reviews\",\n  importName: \"YotpoReviews\",\n  importPath: modulePath,\n  providesData: true,\n  description: \"Yotpo Reviews for your product pages \",\n  defaultStyles: {\n    width: \"400px\",\n    height: \"600px\",\n  },\n  props: {\n    reviewId: {\n      type: \"choice\",\n      options: (props, ctx) =>\n        ctx?.reviews?.map((item: any) => ({\n          label: item?.name,\n          value: item?.id,\n        })) ?? [],\n      displayName: \"Review\",\n      description: \"Review Widget which to be displayed\",\n    },\n    productPrice: {\n      type: \"string\",\n      displayName: \"Price\",\n      description: \"Price of the Product\",\n    },\n    currency: {\n      type: \"string\",\n      displayName: \"Currency\",\n      description: \"Currency\",\n    },\n  },\n};\n\nexport function YotpoReviews({\n  reviewId,\n  setControlContextData,\n  productPrice,\n  currency,\n  className,\n}: YotpoReviewsProps) {\n  const creds = ensure(useContext(CredentialsContext));\n  const cacheKey = JSON.stringify({\n    creds,\n    reviewId,\n  });\n  React.useEffect(() => {\n    const script = document.createElement(\"script\");\n    script.type = \"text/javascript\";\n    script.async = true;\n    script.innerHTML = `(function e(){var e=document.createElement(\"script\");e.type=\"text/javascript\",e.async=true,e.src=\"//staticw2.yotpo.com/${creds.appKey}/widget.js\";var t=document.getElementsByTagName(\"script\")[0];t.parentNode.insertBefore(e,t)})();`;\n    document.body.appendChild(script);\n\n    return () => {\n      document.body.removeChild(script);\n    };\n  }, [creds]);\n\n  const { data: reviewsData } = usePlasmicQueryData<any | null>(\n    `${cacheKey}/reviews`,\n    async () => {\n      const options = {\n        method: \"GET\",\n        headers: {\n          accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n        },\n      };\n\n      const res = await fetch(\n        `https://api.yotpo.com/v1/apps/${creds.appKey}/reviews?utoken=${creds.uToken}`,\n        options\n      );\n      return res.json();\n    }\n  );\n\n  const { data: reviewData } = usePlasmicQueryData<ReviewResponse | null>(\n    `${cacheKey}/review`,\n    async () => {\n      if (!reviewId) {\n        return undefined;\n      }\n      const options = {\n        method: \"GET\",\n        headers: {\n          accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n        },\n      };\n\n      const res = await fetch(\n        `https://api.yotpo.com/reviews/${reviewId}?utoken=${creds.uToken}`,\n        options\n      );\n      return res.json();\n    }\n  );\n\n  if (!reviewsData) {\n    return (\n      <div>\n        Please configure the Yotpo Credentials provider with valid AppKey.\n      </div>\n    );\n  }\n  const data = Object.values(reviewsData).map((item: any) => item);\n\n  setControlContextData?.({\n    reviews: data[0] || [],\n  });\n\n  if (!creds.uToken || !creds.appKey) {\n    return <div>Please specify a valid API Credentials: uToken,appKey</div>;\n  }\n\n  if (!reviewData) {\n    return <div>Please choose the reviewId</div>;\n  }\n\n  if (!productPrice || !currency) {\n    return <div> Please enter Product price and Currency</div>;\n  }\n\n  const review = Object.values(reviewsData).flatMap((item: any, i: number) =>\n    (isArray(item) ? item : [item]).filter(\n      (review: any) => review.id === reviewId\n    )\n  );\n\n  const renderedData = reviewData?.response.review.products.map(\n    (item: ProductElement) => {\n      const imageUrl = item?.Product.images.map((image: Image) => {\n        return image.image_url;\n      });\n      return (\n        <div\n          key={item.Product.id}\n          className=\"yotpo yotpo-main-widget\"\n          data-product-id={review[0]?.sku}\n          data-price={productPrice}\n          data-currency={currency}\n          data-name={item?.Product.name}\n          data-url={item?.Product.shorten_url}\n          data-image-url={imageUrl}\n        ></div>\n      );\n    }\n  );\n  return <div className={className}>{renderedData}</div>;\n}\n\ninterface YotpoStarRatingProps {\n  productId: string;\n  className?: string;\n  setControlContextData?: (data: {\n    reviews?: { name: string; id: number }[];\n  }) => void;\n}\n\nexport const YotpoStarRatingMeta: ComponentMeta<YotpoStarRatingProps> = {\n  name: \"hostless-yotpo-star-rating\",\n  displayName: \"Yotpo Star Rating\",\n  importName: \"YotpoStarRating\",\n  importPath: modulePath,\n  providesData: true,\n  description: \"Yotpo Star Rating for your product pages \",\n  props: {\n    productId: {\n      type: \"choice\",\n      options: (props, ctx) =>\n        ctx?.reviews?.map((item: any) => ({\n          label: item?.name,\n          value: item?.id,\n        })) ?? [],\n      displayName: \"Product\",\n      description: \"Product which you want to show rating\",\n    },\n  },\n};\n\nexport function YotpoStarRating({\n  productId,\n  className,\n  setControlContextData,\n}: YotpoStarRatingProps) {\n  const creds = ensure(useContext(CredentialsContext));\n  const cacheKey = JSON.stringify({\n    creds,\n    productId,\n  });\n  React.useEffect(() => {\n    const script = document.createElement(\"script\");\n    script.type = \"text/javascript\";\n    script.async = true;\n    script.innerHTML = `(function e(){var e=document.createElement(\"script\");e.type=\"text/javascript\",e.async=true,e.src=\"//staticw2.yotpo.com/${creds.appKey}/widget.js\";var t=document.getElementsByTagName(\"script\")[0];t.parentNode.insertBefore(e,t)})();`;\n    document.body.appendChild(script);\n\n    return () => {\n      document.body.removeChild(script);\n    };\n  }, [creds]);\n\n  const { data: reviews } = usePlasmicQueryData<any | null>(\n    `${cacheKey}/starReviews`,\n    async () => {\n      const options = {\n        method: \"GET\",\n        headers: {\n          accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n        },\n      };\n\n      const res = await fetch(\n        `https://api.yotpo.com/v1/apps/${creds.appKey}/reviews?utoken=${creds.uToken}`,\n        options\n      );\n      return res.json();\n    }\n  );\n  const { data: review } = usePlasmicQueryData<ReviewResponse | null>(\n    `${cacheKey}/starReview`,\n    async () => {\n      if (!productId) {\n        return undefined;\n      }\n      const options = {\n        method: \"GET\",\n        headers: {\n          accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n        },\n      };\n\n      const res = await fetch(\n        `https://api.yotpo.com/reviews/${productId}?utoken=${creds.uToken}`,\n        options\n      );\n      return res.json();\n    }\n  );\n\n  if (!creds.uToken || !creds.appKey) {\n    return <div>Please specify a valid API Credentials: uToken,appKey</div>;\n  }\n\n  if (!reviews) {\n    return (\n      <div>\n        Please configure the Yotpo Credentials provider with valid AppKey.\n      </div>\n    );\n  }\n\n  const data = Object.values(reviews).map((item: any) => item);\n\n  setControlContextData?.({\n    reviews: data[0] || [],\n  });\n\n  if (!review) {\n    return (\n      <div>\n        Please configure the Yotpo Credentials provider with valid AppKey.\n      </div>\n    );\n  }\n  const product = Object.values(reviews).flatMap((item: any, i: number) =>\n    (isArray(item) ? item : [item]).filter(\n      (review: any) => review.id === productId\n    )\n  );\n\n  const renderedData = review?.response.review.products.map(\n    (item: ProductElement) => (\n      <div\n        className=\"yotpo bottomLine\"\n        data-product-id={product[0]?.sku}\n        data-url={item.Product.product_url}\n      />\n    )\n  );\n\n  return <div className={className}>{renderedData}</div>;\n}\n","import React from 'react'\nimport registerComponent, {\n  ComponentMeta,\n} from \"@plasmicapp/host/registerComponent\";\nimport registerGlobalContext from \"@plasmicapp/host/registerGlobalContext\";\nimport {\n  YotpoCredentialsProvider,\n  YotpoCredentialsProviderMeta,\n  YotpoReviewsMeta,\n  YotpoReviews,\n  YotpoStarRating,\n  YotpoStarRatingMeta\n} from \"./yotpo\";\n\nexport function registerAll(loader?: {\n  registerComponent: typeof registerComponent;\n  registerGlobalContext: typeof registerGlobalContext;\n}) {\n  const _registerComponent = <T extends React.ComponentType<any>>(\n    Component: T,\n    defaultMeta: ComponentMeta<React.ComponentProps<T>>\n  ) => {\n    if (loader) {\n      loader.registerComponent(Component, defaultMeta);\n    } else {\n      registerComponent(Component, defaultMeta);\n    }\n  };\n\n  if (loader) {\n    loader.registerGlobalContext(\n      YotpoCredentialsProvider,\n      YotpoCredentialsProviderMeta\n    );\n  } else {\n    registerGlobalContext(\n      YotpoCredentialsProvider,\n      YotpoCredentialsProviderMeta\n    );\n  }\n\n  _registerComponent(YotpoReviews, YotpoReviewsMeta);\n  _registerComponent(YotpoStarRating, YotpoStarRatingMeta);\n\n}\n\nexport * from \"./yotpo\";\n"],"names":["ensure","x","Error","modulePath","CredentialsContext","React","createContext","undefined","YotpoCredentialsProviderMeta","name","displayName","description","importName","importPath","props","appKey","type","uToken","YotpoCredentialsProvider","_ref","Provider","value","children","YotpoReviewsMeta","providesData","defaultStyles","width","height","reviewId","options","ctx","_ctx$reviews$map","_ctx$reviews","reviews","map","item","label","id","productPrice","currency","YotpoReviews","_ref2","setControlContextData","className","creds","useContext","cacheKey","JSON","stringify","useEffect","script","document","createElement","async","innerHTML","body","appendChild","removeChild","reviewsData","usePlasmicQueryData","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","method","headers","accept","Content-Type","fetch","abrupt","sent","json","stop","data","reviewData","_callee2","_context2","Object","values","review","flatMap","i","isArray","filter","renderedData","response","products","imageUrl","Product","images","image","image_url","key","_review$","sku","shorten_url","YotpoStarRatingMeta","productId","_ctx$reviews$map2","_ctx$reviews2","YotpoStarRating","_ref5","_callee3","_context3","_callee4","_context4","product","_product$","product_url","loader","_registerComponent","Component","defaultMeta","registerComponent","registerGlobalContext"],"mappings":"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"}